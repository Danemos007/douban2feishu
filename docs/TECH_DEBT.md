# 项目技术债务清单 (Project Technical Debt Log)

本文档用于记录项目中已知的设计或实现上的妥协，以便未来进行跟踪和偿还。

---

### TD-001: Zod 库版本固定在 v3

* **债务识别日期**: 2025-09-08
* **状态**: 🔴 已接受 (Accepted)

#### **背景与原因 (Context & Reason)**

在尝试修复 Zod v4 引起的 `TS1259` 编译错误时，我们发现根治方案（`"moduleResolution": "node16"`）与项目当前基于 CommonJS 的 NestJS 架构存在根本性冲突，升级风险极高。为保证项目稳定性和开发进度，我们决策放弃升级，将 Zod 库版本降级并固定在最新的 v3 版本（`3.23.8`）。

#### **债务成本 (Debt Cost / Impact)**

1.  **功能滞后**: 无法使用 Zod v4 及更高版本的新特性、Schema 优化和性能改进。
2.  **安全风险**: 长期来看，Zod v3 的安全更新和社区支持将逐渐停止。
3.  **生态脱节**: 社区新的教程、文章和相关库将主要围绕 Zod v4+ 构建，增加团队成员的学习和整合成本。

#### **偿还计划 (Repayment Plan)**

此技术债务的偿还与整个项目的模块系统升级强相关。我们将在以下时机重新评估并着手偿还此债务：

* **触发条件**: 当我们计划将项目整体从 CommonJS 迁移到 ESM 架构时，或当 NestJS 官方对 ESM 提供更成熟、稳定的支持时。
* **偿还步骤**:
    1.  执行项目级的 ESM 迁移。
    2.  将 Zod 升级到最新版本。
    3.  移除此条技术债务记录。

---

### TD-002: 项目模块系统从 CommonJS (CJS) 迁移至 ECMAScript Modules (ESM)

* **债务识别日期**: 2025-09-08
* **状态**: 🔵 已规划 (Planned) / 待办 (Backlog)

#### **背景与原因 (Context & Reason)**
在解决 Zod v4 的编译问题时，我们发现项目的 CJS 架构与现代 TypeScript 的 ESM 解析策略存在冲突。为了在项目初期规避巨大的架构迁移风险、优先保障产品功能开发和上线，我们决定推迟整个项目的 ESM 迁移工作。

#### **债务成本 (Debt Cost / Impact)**
1.  无法使用仅支持 ESM 的新型 npm 包。
2.  与 Node.js 和 TypeScript 的未来主流方向暂时脱节。
3.  某些现代构建工具和库的性能优势无法完全发挥。

#### **偿还计划 (Repayment Plan)**
这是一个“史诗级”重构任务，应在一个独立、完整、不受干扰的开发周期内完成。
* **触发条件**:
    1.  产品核心功能已上线，并稳定运行至少1-3个月后。
    2.  在规划项目的下一个主要版本（例如 v2.0）时，可将其作为核心技术升级任务。
    3.  当遇到必须使用某个仅支持 ESM 的“杀手级”库时。
* **偿还步骤**: 需单独制定详细的迁移、测试和灰度发布计划。