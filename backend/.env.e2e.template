# E2E测试环境变量模板
# 复制此文件为 .env.e2e 并填入真实值（用于真实API模式测试）

# 测试环境标识
NODE_ENV=test
IS_E2E_TEST=true

# ================================
# E2E测试模式配置
# ================================
# Mock模式（默认，用于CI）：拦截所有HTTP请求，使用预设数据
# 真实API模式：连接真实的豆瓣和飞书服务
USE_MOCK_DOUBAN=true
USE_MOCK_FEISHU=true

# ================================
# 测试数据规模配置
# ================================
# QUICK模式：测试1-2条数据（适用于CI快速验证）
# FULL模式：测试约120条数据（适用于夜间完整验证）
E2E_TEST_MODE=QUICK  # 可选值: QUICK | FULL

# 快速模式配置
E2E_QUICK_BOOK_COUNT=2
E2E_QUICK_MOVIE_COUNT=0
E2E_QUICK_TV_COUNT=0

# 全量模式配置（真实API模式下的数据量）
E2E_FULL_BOOK_COUNT=120
E2E_FULL_MOVIE_COUNT=50
E2E_FULL_TV_COUNT=30

# ================================
# 数据库配置
# ================================
# 注意：本地使用非标准端口（5433/6380），CI环境使用标准端口（5432/6379）
DATABASE_URL=postgresql://d2f_test_user:d2f_test_password@localhost:5433/d2f_test

# Redis配置（缓存）
REDIS_HOST=localhost
REDIS_PORT=6380
REDIS_DB=1  # 使用DB1避免与集成测试冲突

# BullMQ配置（任务队列） - 必须与Redis配置一致
BULL_REDIS_HOST=localhost
BULL_REDIS_PORT=6380

# ================================
# JWT配置
# ================================
JWT_SECRET=e2e-test-jwt-secret-changeme
JWT_EXPIRATION=1h

# ================================
# 加密配置
# ================================
MASTER_ENCRYPTION_KEY=your-master-encryption-key-minimum-32-chars

# ================================
# 测试用户凭证
# ================================
E2E_TEST_EMAIL=e2e-test@example.com
E2E_TEST_PASSWORD=e2e-test-password-changeme

# ================================
# 豆瓣配置（真实API模式必填）
# ================================
# Mock模式下：使用格式正确的占位符Cookie（包含bid和dbcl2字段）
# 真实API模式：必须填入有效的豆瓣Cookie
# 格式要求：必须包含 bid 或 dbcl2 字段，字符范围：[a-zA-Z0-9_=;%\-\s.":'/]
DOUBAN_COOKIE='bid=mock123abc; dbcl2="999999:mocksecret"; ll="118282"; ck=mockCk; frodotk_db="mocktoken123"'

# 豆瓣测试账号（用于验证）
DOUBAN_USER_ID="999999"

# ================================
# 飞书配置（真实API模式必填）
# ================================
# Mock模式下：使用占位符即可
# 真实API模式：必须填入有效的飞书应用凭证
FEISHU_APP_ID="your_feishu_app_id_here"
FEISHU_APP_SECRET="your_feishu_app_secret_here"
FEISHU_APP_TOKEN="your_feishu_app_token_here"

# 飞书多维表格配置（真实API模式必填）
FEISHU_BOOK_TABLE_ID="your_book_table_id_here"
FEISHU_MOVIE_TABLE_ID="your_movie_table_id_here"
FEISHU_DOC_TABLE_ID="your_doc_table_id_here"
FEISHU_TV_TABLE_ID="your_tv_table_id_here"

# ================================
# E2E测试超时配置
# ================================
# Mock模式：30秒足够
# 真实API模式（QUICK）：5分钟（考虑反爬虫延迟）
# 真实API模式（FULL）：30分钟（120条数据，每条4-8秒）
E2E_TIMEOUT_MOCK=30000
E2E_TIMEOUT_REAL_QUICK=300000
E2E_TIMEOUT_REAL_FULL=1800000
