# 🧪 测试文件使用指南 - Claude接手必读

## 📋 项目状态概览

**当前阶段：** 第三阶段飞书API集成（调试期）
**关键问题：** API同步机制需要修复，"认ID不认名"策略刚更正完毕
**测试文件状态：** 全部保留，分类整理便于新Claude快速定位

---

## 🗂️ 测试文件分类目录

### 🚀 **1. 核心功能测试（重要程度：⭐⭐⭐⭐⭐）**

#### 📡 飞书API集成测试
```bash
# 完整飞书功能测试
src/feishu/test-feishu-integration.ts        # 飞书API集成测试
src/feishu/test-field-mapping-v2.ts         # 字段映射V2测试  
src/feishu/simple-v2-test.ts                # V2策略简单验证

# 多表格综合测试
src/feishu/test-4tables-comprehensive.ts    # 4表格完整测试
src/feishu/test-tv-table-completion.ts      # 电视剧表格测试
src/feishu/test-v2-direct.ts               # V2直接测试

# 端到端测试
src/end-to-end-sync-test.ts                 # 完整同步流程测试
```

#### 🐾 豆瓣数据抓取测试
```bash
# 组件测试
src/douban/test-douban.controller.ts        # 豆瓣控制器测试
src/douban/movie-optimized-test.ts          # 电影抓取优化测试
src/douban/full-test.ts                     # 完整功能测试

# 数据类型测试
src/douban/movie-test.ts                    # 电影数据测试
src/douban/wish-test.ts                     # 想读/想看列表测试
src/douban/mock-test.ts                     # 模拟数据测试
```

### 🔧 **2. 当前调试相关（重要程度：⭐⭐⭐⭐）**

#### ❌ 待解决的同步问题
```bash
# API策略相关（刚修正完毕，需要重新验证）
src/field-name-based-sync-test.ts           # 字段名匹配策略测试
src/field-id-validation-test.ts             # Field ID验证（可能已过时）

# 数据同步问题
src/real-data-sync-test.ts                  # 真实数据同步测试
src/simple-real-data-test.ts               # 简化真实数据测试
src/simple-test-sync.ts                    # 简单同步测试
```

#### 🎬 电影数据修复验证（用户最近使用）
```bash
# 重要：用户最近使用的测试
src/test-movie-complete.ts                  # 电影完整测试（已应用3个修复）
src/test-fix-key-movies.ts                  # 关键电影修复测试
src/test-fix-verification.ts               # 修复效果验证

# 具体问题修复
src/test-piper-duration.ts                  # 《鹬》片长解析修复
src/test-chulian-duration.ts               # 《初恋这件小事》修复
src/test-release-date-fix.ts               # 上映日期修复
src/test-release-date.ts                   # 上映日期测试
```

### 🔍 **3. 数据格式验证（重要程度：⭐⭐⭐）**

#### 📊 字段格式测试
```bash
# 评分字段
src/test-book-rating.ts                     # 书籍评分测试
src/test-rating-field.ts                   # 评分字段测试

# 其他格式
src/test-status-format.ts                  # 状态格式测试
src/test-url-field-format.ts               # URL字段格式测试
```

### 🛠️ **4. 基础API测试（重要程度：⭐⭐）**

#### 🔌 基础连接测试
```bash
# API连接测试
src/basic-api-test.ts                       # 基础API测试
src/test-nestjs-service.ts                 # NestJS服务测试

# 数据写入测试
src/simple-write-test.ts                   # 简单写入测试
src/standalone-data-write-test.ts          # 独立数据写入测试
```

### 🚨 **5. 问题诊断与修复（重要程度：⭐⭐）**

#### 🩺 系统诊断
```bash
# 权限问题
src/permission-fix-data-write-test.ts      # 权限修复测试

# 系统诊断
src/system-diagnosis-test.ts               # 系统诊断测试

# 独立测试
src/douban/standalone-test.ts              # 豆瓣独立测试
src/full-movie-test.ts                     # 完整电影测试
```

---

## 🎯 **新Claude接手指南**

### 📝 **第一步：了解当前状态**
1. 阅读 `CLAUDE.md` 了解整体进度
2. 检查 `test-movie-complete.ts` 了解最新修复情况
3. 运行 `npm run test:feishu-v2` 验证当前功能状态

### 🔍 **第二步：定位问题**
```bash
# 如果同步失败，优先检查：
src/real-data-sync-test.ts                  # 真实数据同步问题
src/field-name-based-sync-test.ts           # 字段匹配策略问题

# 如果数据解析有问题，检查：
src/test-movie-complete.ts                  # 最新的修复验证
src/douban/movie-optimized-test.ts          # 豆瓣数据抓取问题
```

### ⚡ **第三步：快速验证**
```bash
# 快速验证核心功能
npm run test:feishu              # 飞书集成
npm run test:douban             # 豆瓣抓取
npm run test:douban-movie-opt   # 电影数据优化
```

---

## ⚠️ **重要提醒**

### 🚨 **已知问题**
1. **API同步失败** - 批量API vs 单条API问题待解决
2. **"认ID不认名"策略** - 刚修正完毕，需重新验证所有相关测试
3. **数据写入为空** - 用户反馈"数据都是空的"，核心问题未解决

### 📋 **测试文件不要删除的原因**
- 调试期间可能需要任何一个测试文件
- 策略变更后需要大量回归测试
- 问题排查时需要对比不同实现方式

### 🔄 **何时可以清理测试文件**
- ✅ 同步功能100%稳定
- ✅ 生产环境运行无问题  
- ✅ 至少2-3轮完整回归测试通过
- ✅ 第三阶段完全完成后

---

## 📞 **快速参考**

### 🆘 **常见问题对应的测试文件**
- 同步失败 → `real-data-sync-test.ts`, `end-to-end-sync-test.ts`
- 字段映射问题 → `test-field-mapping-v2.ts`, `field-name-based-sync-test.ts`  
- 豆瓣抓取问题 → `douban/movie-optimized-test.ts`, `test-movie-complete.ts`
- 飞书API问题 → `test-feishu-integration.ts`, `simple-v2-test.ts`

### 📊 **测试命令快速参考**
```bash
# 核心测试命令
npm run test:feishu-v2          # 飞书V2策略测试
npm run test:douban            # 豆瓣数据测试  
npm run test:douban-movie-opt  # 电影优化测试

# 直接运行测试文件
npx ts-node src/test-movie-complete.ts       # 最新电影修复测试
npx ts-node src/real-data-sync-test.ts       # 真实数据同步测试
```

---

**最后更新：** 2025-08-28  
**更新人：** Claude (Sonnet 4)  
**项目阶段：** 第三阶段调试期